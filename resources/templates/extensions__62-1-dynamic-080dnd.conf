; Dynamic 080 dnd

[dynamic-080dnd]
; ${DIPCAST-080DND-AUTO} : 발신자 표시번호 자동 등록 여부 (```1``` or ```0```)
; ${DIPCAST-080DND-INTRO} : 인트로 사운드
; ${DIPCAST-080DND-TEMINATED} : 통화종료 사운드
; ${DIPCAST-080DND-RETRY} : 발신자 표시이름
exten => init,1,NoOp(DYNAMIC 080 DND, ${DIPCAST-CHANNEL-CIDNUMBER}, ${DIPCAST-CHANNEL-SERVICENUMBER}, ${DIPCAST-CHANNEL-LINKEDID})

 same => n,Set(__DIPCAST-CHANNEL-CIDNUMBER=01026132471)
 same => n,Set(__DIPCAST-CHANNEL-SERVICENUMBER=0801112222)
 same => n,Playback(silence/1&custom/hi)
 same => n,BackGround(custom/080-dnd-intro)
 same => n,Playback(custom/080-dnd-play-cidnumber-pre)
 same => n,SayDigits(${DIPCAST-CHANNEL-CIDNUMBER})
 same => n,Playback(custom/yipnida)
 same => n,Set(INVALIDATTEMPTS=0)
 same => n,Set(TIMEOUTATTEMPTS=0)
 same => n,Set(TIMEOUT(digit)=2)
 same => n,Set(TIMEOUT(response)=5)
 same => n,Set(__PBX_APP=QUEUE)
 same => n,Set(__PBX_APP_DESC=등록 번호가 맞으면 1번, 아니면 2번)
 same => n,Answer()
 same => n(begin),NoOp(IVR Menu Begin)
 ;same => n(welcome-background),BackGround(silence/1&custom/080-dnd-intro)
 same => n(retry),NoOp(IVR Retry Section)
 same => n(retry-background),BackGround(silence/1&custom/080-dnd-confrim-1-2)
 same => n,WaitExten(5)

exten => 1,1,NoOp(1번 누름)
 same => n,Set(__SRC_APP=IVR)
 same => n,Set(CALL_DESTINATION=${EXTEN})
 same => n,Playback(custom/080-dnd-complete)
 same => n,UserEvent("080dnd","Registration: ${DIPCAST-CHANNEL-CIDNUMBER}, ${DIPCAST-CHANNEL-SERVICENUMBER}, ${DIPCAST-CHANNEL-LINKEDID}")
 same => n,Playback(custom/goodbye)

exten => 2,1,NoOp(2번 누름)
 same => n,Set(__SRC_APP=IVR)
 same => n,Set(CALL_DESTINATION=${EXTEN})
 same => n,Goto(T2_custom-contexts,cc-22,1)

exten => #,1,Hangup()

exten => *,1,Goto(init,begin)

exten => t,1,Set(TIMEOUTATTEMPTS=$[${TIMEOUTATTEMPTS}+1])
 same => n,GotoIf($[${TIMEOUTATTEMPTS}>=3]?timeout)
 same => n(timeout),BackGround(custom/080-dnd-timeout)
 same => n,Goto(init,begin)
 same => n(timeout),BackGround(custom/080-dnd-end-retry)
 same => n,Goto(h,1)

exten => i,1,Set(INVALIDATTEMPTS=$[${INVALIDATTEMPTS}+1])
 same => n,GotoIf($[${INVALIDATTEMPTS}>=3]?invalid)
 same => n(invalid),BackGround(custom/080-dnd-incorrect)
 same => n,Goto(init,begin)
 same => n(invalid),BackGround(custom/080-dnd-end-retry)
 same => n,Goto(h,1)

exten => invalid_dial,1,NoCDR()
 same => n,NoOp(Invalid Numbering Dial)
 same => n,Playback(silence/1&no-route-exists-to-dest&vm-pls-try-again)
 same => n,Set(INVALID_DIAL=yes)
 same => n,Goto(i,1)

exten => h,1,NoOp(HANGUP)
 same => n,Hangup()

[dynamic-080-dnd-input-number-short] 
exten => init,1,NoOp(DYNAMIC 080 DND INPUT NUMBER SHORT, ${DIPCAST-CHANNEL-CIDNUMBER}, ${DIPCAST-CHANNEL-SERVICENUMBER}, ${DIPCAST-CHANNEL-LINKEDID})
 same => n,Set(INVALIDATTEMPTS=0)
 same => n,Set(TIMEOUTATTEMPTS=0)
 same => n,Set(TIMEOUT(digit)=2)
 same => n,Set(TIMEOUT(response)=5)
 same => n,Set(__PBX_APP=QUEUE)
 same => n,Set(__PBX_APP_DESC=등록을 원하는 번호를 입력하시고 우물정자를 누르세요)
 same => n,Answer()
 same => n(begin),NoOp(IVR Menu Begin)
 ;same => n(welcome-background),BackGround(silence/1&custom/080-dnd-intro)
 same => n(retry),NoOp(IVR Retry Section)
 same => n(retry-background),BackGround(silence/1&custom/080-dnd-confrim-1-2)
 same => n,WaitExten(5)

exten => _[*#+0-9].,1,NoOp(Korea Mobile Number ${EXTEN})
 same => n,NoCDR()
 same => n,Set(__SRC_APP=IVR)
 same => n,Dial(Local/${EXTEN}@T2_ivr-only-extensions/n)
 same => n,GotoIf($["${DIALSTATUS}"="NOANSWER"]?invalid_dial,1)
 same => n,Hangup()

exten => #,1,Hangup()

exten => *,1,Goto(init,begin)

exten => t,1,Set(TIMEOUTATTEMPTS=$[${TIMEOUTATTEMPTS}+1])
 same => n,GotoIf($[${TIMEOUTATTEMPTS}>=3]?timeout)
 same => n(timeout),BackGround(custom/080-dnd-timeout)
 same => n,Goto(init,begin)
 same => n(timeout),BackGround(custom/080-dnd-end-retry)
 same => n,Goto(h,1)

exten => i,1,Set(INVALIDATTEMPTS=$[${INVALIDATTEMPTS}+1])
 same => n,GotoIf($[${INVALIDATTEMPTS}>=3]?invalid)
 same => n(invalid),BackGround(custom/080-dnd-incorrect)
 same => n,Goto(init,begin)
 same => n(invalid),BackGround(custom/080-dnd-end-retry)
 same => n,Goto(h,1)

exten => h,1,NoOp(HANGUP)
 same => n,Hangup()


 ; Return 서브 루틴 복귀
 same => n(return),Return()